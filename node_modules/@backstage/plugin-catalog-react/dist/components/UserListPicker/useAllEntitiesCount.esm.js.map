{"version":3,"file":"useAllEntitiesCount.esm.js","sources":["../../../src/components/UserListPicker/useAllEntitiesCount.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { QueryEntitiesInitialRequest } from '@backstage/catalog-client';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { compact, isEqual } from 'lodash';\nimport { useMemo, useRef } from 'react';\nimport useAsync from 'react-use/esm/useAsync';\nimport { catalogApiRef } from '../../api';\nimport { useEntityList } from '../../hooks';\nimport { reduceCatalogFilters } from '../../utils';\n\nexport function useAllEntitiesCount() {\n  const catalogApi = useApi(catalogApiRef);\n  const { filters } = useEntityList();\n\n  const prevRequest = useRef<QueryEntitiesInitialRequest>();\n  const request = useMemo(() => {\n    const { user, ...allFilters } = filters;\n    const compacted = compact(Object.values(allFilters));\n    const catalogFilters = reduceCatalogFilters(compacted);\n    const newRequest: QueryEntitiesInitialRequest = {\n      ...catalogFilters,\n      limit: 0,\n    };\n\n    if (Object.keys(catalogFilters.filter).length === 0) {\n      prevRequest.current = undefined;\n      return prevRequest.current;\n    }\n\n    if (isEqual(newRequest, prevRequest.current)) {\n      return prevRequest.current;\n    }\n    prevRequest.current = newRequest;\n    return newRequest;\n  }, [filters]);\n\n  const { value: count, loading } = useAsync(async () => {\n    if (request === undefined) {\n      return 0;\n    }\n    const { totalItems } = await catalogApi.queryEntities(request);\n\n    return totalItems;\n  }, [request]);\n\n  return { count, loading };\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAwBO,SAAS,mBAAsB,GAAA;AACpC,EAAM,MAAA,UAAA,GAAa,OAAO,aAAa,CAAA,CAAA;AACvC,EAAM,MAAA,EAAE,OAAQ,EAAA,GAAI,aAAc,EAAA,CAAA;AAElC,EAAA,MAAM,cAAc,MAAoC,EAAA,CAAA;AACxD,EAAM,MAAA,OAAA,GAAU,QAAQ,MAAM;AAC5B,IAAA,MAAM,EAAE,IAAA,EAAM,GAAG,UAAA,EAAe,GAAA,OAAA,CAAA;AAChC,IAAA,MAAM,SAAY,GAAA,OAAA,CAAQ,MAAO,CAAA,MAAA,CAAO,UAAU,CAAC,CAAA,CAAA;AACnD,IAAM,MAAA,cAAA,GAAiB,qBAAqB,SAAS,CAAA,CAAA;AACrD,IAAA,MAAM,UAA0C,GAAA;AAAA,MAC9C,GAAG,cAAA;AAAA,MACH,KAAO,EAAA,CAAA;AAAA,KACT,CAAA;AAEA,IAAA,IAAI,OAAO,IAAK,CAAA,cAAA,CAAe,MAAM,CAAA,CAAE,WAAW,CAAG,EAAA;AACnD,MAAA,WAAA,CAAY,OAAU,GAAA,KAAA,CAAA,CAAA;AACtB,MAAA,OAAO,WAAY,CAAA,OAAA,CAAA;AAAA,KACrB;AAEA,IAAA,IAAI,OAAQ,CAAA,UAAA,EAAY,WAAY,CAAA,OAAO,CAAG,EAAA;AAC5C,MAAA,OAAO,WAAY,CAAA,OAAA,CAAA;AAAA,KACrB;AACA,IAAA,WAAA,CAAY,OAAU,GAAA,UAAA,CAAA;AACtB,IAAO,OAAA,UAAA,CAAA;AAAA,GACT,EAAG,CAAC,OAAO,CAAC,CAAA,CAAA;AAEZ,EAAA,MAAM,EAAE,KAAO,EAAA,KAAA,EAAO,OAAQ,EAAA,GAAI,SAAS,YAAY;AACrD,IAAA,IAAI,YAAY,KAAW,CAAA,EAAA;AACzB,MAAO,OAAA,CAAA,CAAA;AAAA,KACT;AACA,IAAA,MAAM,EAAE,UAAW,EAAA,GAAI,MAAM,UAAA,CAAW,cAAc,OAAO,CAAA,CAAA;AAE7D,IAAO,OAAA,UAAA,CAAA;AAAA,GACT,EAAG,CAAC,OAAO,CAAC,CAAA,CAAA;AAEZ,EAAO,OAAA,EAAE,OAAO,OAAQ,EAAA,CAAA;AAC1B;;;;"}