{"version":3,"file":"overrides.esm.js","sources":["../../src/unified/overrides.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Overrides } from '@material-ui/core/styles/overrides';\nimport type { ComponentsProps } from '@material-ui/core/styles/props';\nimport { ComponentsOverrides, Theme, ThemeOptions } from '@mui/material/styles';\nimport { CSSProperties } from 'react';\n\ntype V5Override = ComponentsOverrides[Exclude<\n  keyof ComponentsOverrides,\n  'MuiCssBaseline'\n>];\ntype V4Override = Overrides[keyof Overrides];\ntype StaticStyleRules = Record<\n  string,\n  CSSProperties | Record<string, CSSProperties>\n>;\n\n// Utility function based on v5 `createSpacing`: https://github.com/mui/material-ui/blob/master/packages/mui-system/src/createTheme/createSpacing.ts#L42C3-L59C5\nconst __v5Spacing =\n  (defaultSpacing: number) =>\n  (...argsInput: ReadonlyArray<number | string>) => {\n    const args = argsInput.length === 0 ? [1] : argsInput;\n    const transform = (argument: string | number, themeSpacing: number) => {\n      if (typeof argument === 'string') {\n        return argument;\n      }\n      return themeSpacing * argument;\n    };\n\n    return args\n      .map(argument => {\n        const output = transform(argument, defaultSpacing);\n        return typeof output === 'number' ? `${output}px` : output;\n      })\n      .join(' ');\n  };\n\n// Converts callback-based overrides to static styles, e.g.\n// { root: theme => ({ color: theme.color }) } -> { root: { color: 'red' } }\nfunction adaptV5CssBaselineOverride(\n  theme: Theme,\n  overrides: ComponentsOverrides['MuiCssBaseline'],\n): StaticStyleRules | undefined {\n  if (!overrides || typeof overrides === 'string') {\n    return undefined;\n  }\n\n  const styles = typeof overrides === 'function' ? overrides(theme) : overrides;\n  if (styles) {\n    return { '@global': styles } as StaticStyleRules;\n  }\n\n  return undefined;\n}\n\n// Converts callback-based overrides to static styles, e.g.\n// { root: theme => ({ color: theme.color }) } -> { root: { color: 'red' } }\nfunction adaptV5Override(\n  theme: Theme,\n  overrides: V5Override,\n): StaticStyleRules | undefined {\n  if (!overrides || typeof overrides === 'string') {\n    return undefined;\n  }\n  if (typeof overrides === 'object') {\n    const _theme = { ...theme };\n    const defaultSpacing = theme.spacing(1);\n    if (typeof defaultSpacing === 'number') {\n      // Override potential v4 spacing method: https://mui.com/material-ui/migration/v5-style-changes/#%E2%9C%85-remove-px-suffix\n      // `adaptV4Theme as reference: https://github.com/mui/material-ui/blob/v5.x/packages/mui-material/src/styles/adaptV4Theme.js#L54C41-L54C41\n      _theme.spacing = __v5Spacing(defaultSpacing);\n    }\n    return Object.fromEntries(\n      Object.entries(overrides).map(([className, style]) => {\n        if (typeof style === 'function') {\n          return [className, style({ theme: _theme })];\n        }\n        return [className, style];\n      }),\n    );\n  }\n  return overrides as StaticStyleRules;\n}\n\nconst stateStyleKeyPattern = /^&.Mui-([\\w-]+)$/;\n\n// Move state style overrides to the top level, e.g.\n// { root: { '&.Mui-active': { color: 'red' } } } -> { active: { color: 'red' } }\nfunction extractV5StateOverrides(\n  overrides: StaticStyleRules | undefined,\n): StaticStyleRules | undefined {\n  let output = overrides;\n  if (!overrides || typeof overrides !== 'object') {\n    return output;\n  }\n  for (const className of Object.keys(overrides)) {\n    const styles = overrides[className];\n    if (!styles || typeof styles !== 'object') {\n      continue;\n    }\n    for (const _styleKey of Object.keys(styles)) {\n      const styleKey = _styleKey as keyof typeof styles;\n      const match = styleKey.match(stateStyleKeyPattern);\n      if (match) {\n        const [, state] = match;\n        const { [styleKey]: stateStyles, ...restStyles } = styles;\n        if (stateStyles) {\n          output = {\n            ...output,\n            [className]: restStyles,\n            [state]: stateStyles,\n          };\n        }\n      }\n    }\n  }\n  return output;\n}\n\n/**\n * Transform Material UI v5 component themes into a v4 theme props and overrides.\n *\n * @public\n */\nexport function transformV5ComponentThemesToV4(\n  theme: Theme,\n  components: ThemeOptions['components'] = {},\n): { overrides: Overrides; props: ComponentsProps } {\n  const overrides: Record<string, V4Override> = {};\n  const props: Record<string, ComponentsProps[keyof ComponentsProps]> = {};\n\n  for (const name of Object.keys(components)) {\n    const component = components[name as keyof typeof components];\n    if (!component) {\n      continue;\n    }\n    if ('styleOverrides' in component) {\n      if (name === 'MuiCssBaseline') {\n        overrides[name] = adaptV5CssBaselineOverride(\n          theme,\n          component.styleOverrides as ComponentsOverrides['MuiCssBaseline'],\n        );\n      } else {\n        overrides[name] = extractV5StateOverrides(\n          adaptV5Override(theme, component.styleOverrides as V5Override),\n        );\n      }\n    }\n    if ('defaultProps' in component) {\n      props[name] = component.defaultProps;\n    }\n  }\n\n  return { overrides, props };\n}\n"],"names":[],"mappings":"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"}